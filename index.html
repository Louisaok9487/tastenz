<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Finder</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FFF7ED; /* Warm background */
            color: #333;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #F97316; /* Tailwind orange-500 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #EA580C; /* Tailwind orange-600 */
        }

        /* Transition for search area minimization */
        .search-area {
            transition: all 0.3s ease-in-out;
        }
        .search-area.minimized {
            height: 80px; /* Reduced height */
            padding-top: 10px;
            padding-bottom: 10px;
            overflow: hidden;
        }
        .search-area.minimized .search-filters,
        .search-area.minimized .search-button-container {
            display: none; /* Hide filters and button when minimized */
        }
        .search-area.minimized .search-input-group {
            flex-direction: row; /* Keep input in a row */
            justify-content: center;
            align-items: center;
        }
        .search-area.minimized .search-input-group input {
            width: 80%; /* Make input wider */
            margin-bottom: 0;
        }
        .search-area.minimized .search-input-group label {
            display: none; /* Hide label */
        }

        /* Restaurant card styling */
        .restaurant-card {
            display: flex;
            flex-direction: column;
            background-color: #FFFFFF;
            border-radius: 1rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
            overflow: hidden;
            transition: transform 0.2s ease-in-out;
        }
        .restaurant-card:hover {
            transform: translateY(-5px);
        }
        .restaurant-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .restaurant-info {
            padding: 1.5rem; /* p-6 */
        }
        .restaurant-name {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600; /* font-semibold */
            color: #F97316; /* orange-500 */
            margin-bottom: 0.5rem;
        }
        .restaurant-details {
            font-size: 0.9rem; /* text-sm */
            color: #6B7280; /* gray-500 */
            margin-bottom: 0.75rem;
        }
        .restaurant-rating {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        .star-icon {
            color: #FBBF24; /* yellow-400 */
            margin-right: 0.25rem;
        }
        .pros-cons {
            font-size: 0.875rem; /* text-sm */
            color: #4B5563; /* gray-700 */
            margin-top: 1rem;
            border-top: 1px solid #E5E7EB; /* gray-200 */
            padding-top: 1rem;
        }
        .pros-cons strong {
            color: #F97316; /* orange-500 */
        }
        .action-buttons {
            display: flex;
            gap: 0.75rem; /* gap-3 */
            margin-top: 1rem;
        }
        .action-buttons a {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem; /* px-4 py-2 */
            border-radius: 0.5rem; /* rounded-lg */
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            transition: background-color 0.2s ease-in-out;
        }
        .action-buttons .map-link {
            background-color: #F97316; /* orange-500 */
            color: #FFFFFF;
        }
        .action-buttons .map-link:hover {
            background-color: #EA580C; /* orange-600 */
        }
        .action-buttons .phone-link {
            background-color: #F3F4F6; /* gray-100 */
            color: #4B5563; /* gray-700 */
        }
        .action-buttons .phone-link:hover {
            background-color: #E5E7EB; /* gray-200 */
        }

        /* Responsive adjustments */
        @media (min-width: 768px) { /* md breakpoint */
            .search-area.minimized .search-input-group input {
                width: auto; /* Reset width on larger screens */
            }
            .search-area.minimized .search-input-group label {
                display: block; /* Show label on larger screens */
            }
            .search-area.minimized .search-filters,
            .search-area.minimized .search-button-container {
                display: block; /* Show filters and button on larger screens */
            }
            .search-area.minimized {
                height: auto; /* Reset height */
            }
        }
        /* Loading indicator styling */
        .loading-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            font-size: 1.2rem;
            color: #F97316;
        }
        .loading-indicator.hidden {
            display: none;
        }
        .spinner {
            border: 4px solid rgba(249, 115, 22, 0.2);
            border-top: 4px solid #F97316;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <header class="bg-orange-600 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold rounded-lg px-3 py-1 bg-orange-700">TasteNZ</h1>
            <nav>
                <ul class="flex space-x-4">
                    <li><a href="#" class="hover:text-orange-200 transition-colors">Home</a></li>
                    <li><a href="#" class="hover:text-orange-200 transition-colors">About</a></li>
                    <li><a href="#" class="hover:text-orange-200 transition-colors">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="flex-grow container mx-auto p-4 md:p-8">
        <!-- Search and Filter Area -->
        <section id="search-section" class="search-area bg-orange-100 p-6 md:p-8 rounded-2xl shadow-xl mb-8 transition-all duration-300 ease-in-out">
            <h2 class="text-3xl font-bold text-orange-800 mb-6 text-center">Find Your Next Meal</h2>

            <div class="flex flex-col md:flex-row md:items-end md:space-x-4 mb-6">
                <div class="flex-1 mb-4 md:mb-0 search-input-group">
                    <label for="style-search" class="block text-orange-700 text-lg font-medium mb-2">Cuisine Style</label>
                    <input type="text" id="style-search" placeholder="e.g. Malaysian, Thai, Japanese"
                           class="w-full p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-colors duration-200">
                </div>
                <div class="flex-1 search-input-group">
                    <label for="location-search" class="block text-orange-700 text-lg font-medium mb-2">Location</label>
                    <input type="text" id="location-search" placeholder="e.g. Auckland CBD, Wellington" value="New Zealand"
                           class="w-full p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-colors duration-200">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-6 search-filters">
                <div class="flex flex-col">
                    <label for="distance-filter" class="block text-orange-700 text-md font-medium mb-1">Distance</label>
                    <select id="distance-filter" class="p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-colors duration-200">
                        <option value="">Any</option>
                        <option value="1">Within 1 km</option>
                        <option value="5">Within 5 km</option>
                        <option value="10">Within 10 km</option>
                        <option value="20">Within 20 km</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <label for="price-range-filter" class="block text-orange-700 text-md font-medium mb-1">Price Range</label>
                    <select id="price-range-filter" class="p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-colors duration-200">
                        <option value="">Any</option>
                        <option value="1">$</option>
                        <option value="2">$$</option>
                        <option value="3">$$$</option>
                        <option value="4">$$$$</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <label for="rating-filter" class="block text-orange-700 text-md font-medium mb-1">Min. Rating</label>
                    <select id="rating-filter" class="p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-colors duration-200">
                        <option value="">Any</option>
                        <option value="4.5">4.5+</option>
                        <option value="4">4+</option>
                        <option value="3.5">3.5+</option>
                        <option value="3">3+</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <label for="rated-by-filter" class="block text-orange-700 text-md font-medium mb-1">Rated By</label>
                    <select id="rated-by-filter" class="p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-colors duration-200">
                        <option value="">Any</option>
                        <option value="100">100+ people</option>
                        <option value="500">500+ people</option>
                        <option value="1000">1000+ people</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <label for="price-filter" class="block text-orange-700 text-md font-medium mb-1">Avg. Price</label>
                    <input type="number" id="price-filter" placeholder="e.g. 25"
                           class="w-full p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-colors duration-200">
                </div>
            </div>

            <div class="text-center search-button-container">
                <button id="search-button"
                        class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-75">
                    Search Restaurants
                </button>
            </div>
        </section>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="loading-indicator hidden">
            <div class="spinner"></div>
            Searching for delicious eats...
        </div>

        <!-- Restaurant Results Area -->
        <section id="results-section">
            <h2 class="text-3xl font-bold text-orange-800 mb-6 text-center">Delicious Finds Near You</h2>
            <div id="restaurant-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Restaurant cards will be injected here by JavaScript -->
            </div>
            <div id="no-results-message" class="hidden text-center text-gray-600 text-lg mt-10">
                No restaurants found matching your criteria. Try adjusting your search!
            </div>
        </section>
    </main>

    <footer class="bg-orange-600 text-white p-4 text-center mt-8 shadow-inner">
        <p>&copy; 2025 TasteNZ. All rights reserved.</p>
    </footer>

    <script>
        // Dummy restaurant data for New Zealand - This will be replaced by API data in a real app
        const dummyRestaurants = [
            {
                id: 'r1',
                name: 'The Golden Spoon',
                type: 'Modern European',
                distance: '2.5 km',
                price: '$$$',
                rating: 4.7,
                ratedBy: 1250,
                photo: 'https://placehold.co/600x400/F97316/FFFFFF?text=Signature+Dish:+Duck+Confit',
                prosCons: {
                    pros: ['Exceptional service', 'Elegant ambiance', 'Decadent desserts'],
                    cons: ['Premium pricing', 'Requires booking ahead']
                },
                googleMapLink: 'https://maps.app.goo.gl/dummy1',
                phone: '+64 9 123 4567'
            },
            {
                id: 'r2',
                name: 'Kiwi Kai Eatery',
                type: 'New Zealand Cuisine',
                distance: '1.1 km',
                price: '$$',
                rating: 4.5,
                ratedBy: 890,
                photo: 'https://placehold.co/600x400/EA580C/FFFFFF?text=Signature+Dish:+Hāngi+Plate',
                prosCons: {
                    pros: ['Authentic local flavours', 'Warm, welcoming staff', 'Cosy and inviting'],
                    cons: ['Limited vegetarian choices']
                },
                googleMapLink: 'https://maps.app.goo.gl/dummy2',
                phone: '+64 4 987 6543'
            },
            {
                id: 'r3',
                name: 'Sakura Sushi & Grill',
                type: 'Japanese',
                distance: '5.8 km',
                price: '$$',
                rating: 4.6,
                ratedBy: 2100,
                photo: 'https://placehold.co/600x400/F97316/FFFFFF?text=Signature+Dish:+Dragon+Roll',
                prosCons: {
                    pros: ['Incredibly fresh sushi', 'Generous bento boxes', 'Efficient service'],
                    cons: ['Can be very busy at peak times']
                },
                googleMapLink: 'https://maps.app.goo.gl/dummy3',
                phone: '+64 3 234 5678'
            },
            {
                id: 'r4',
                name: 'Spice Route Indian',
                type: 'Indian',
                distance: '3.2 km',
                price: '$',
                rating: 4.3,
                ratedBy: 650,
                photo: 'https://placehold.co/600x400/EA580C/FFFFFF?text=Signature+Dish:+Butter+Chicken',
                prosCons: {
                    pros: ['Rich, aromatic curries', 'Excellent value for money', 'Good vegan options'],
                    cons: ['Spice levels can be inconsistent']
                },
                googleMapLink: 'https://maps.app.goo.gl/dummy4',
                phone: '+64 7 876 5432'
            },
            {
                id: 'r5',
                name: 'The Italian Bistro',
                type: 'Italian',
                distance: '0.9 km',
                price: '$$$',
                rating: 4.8,
                ratedBy: 1800,
                photo: 'https://placehold.co/600x400/F97316/FFFFFF?text=Signature+Dish:+Truffle+Pasta',
                prosCons: {
                    pros: ['Authentic pasta dishes', 'Charming, romantic atmosphere', 'Extensive wine selection'],
                    cons: ['Reservations are a must']
                },
                googleMapLink: 'https://maps.app.goo.gl/dummy5',
                phone: '+64 9 555 1234'
            },
            {
                id: 'r6',
                name: 'Dragon Wok',
                type: 'Chinese',
                distance: '4.0 km',
                price: '$',
                rating: 4.1,
                ratedBy: 920,
                photo: 'https://placehold.co/600x400/EA580C/FFFFFF?text=Signature+Dish:+Sweet+Sour+Pork',
                prosCons: {
                    pros: ['Hearty portions', 'Quick service for takeaway', 'Classic Chinese dishes'],
                    cons: ['Can get quite loud']
                },
                googleMapLink: 'https://maps.app.goo.gl/dummy6',
                phone: '+64 9 222 3333'
            },
            {
                id: 'r7',
                name: 'Thai Orchid',
                type: 'Thai',
                distance: '1.5 km',
                price: '$$',
                rating: 4.6,
                ratedBy: 1500,
                photo: 'https://placehold.co/600x400/F97316/FFFFFF?text=Signature+Dish:+Pad+Thai',
                prosCons: {
                    pros: ['Aromatic curries', 'Customisable spice levels', 'Ideal for group dining'],
                    cons: ['Parking can be challenging']
                },
                googleMapLink: 'https://maps.app.goo.gl/dummy7',
                phone: '+64 9 777 8888'
            },
            {
                id: 'r8',
                name: 'Burger Joint NZ',
                type: 'Burgers',
                distance: '0.5 km',
                price: '$',
                rating: 4.4,
                ratedBy: 3000,
                photo: 'https://placehold.co/600x400/EA580C/FFFFFF?text=Signature+Dish:+Classic+Cheeseburger',
                prosCons: {
                    pros: ['Juicy, flavourful burgers', 'Perfectly crispy fries', 'Relaxed, casual vibe'],
                    cons: ['Always a queue']
                },
                googleMapLink: 'https://maps.app.goo.gl/dummy8',
                phone: '+64 9 111 2222'
            },
            {
                id: 'r9',
                name: 'Malaysian Delights',
                type: 'Malaysian',
                distance: '3.7 km',
                price: '$$',
                rating: 4.2,
                ratedBy: 780,
                photo: 'https://placehold.co/600x400/F97316/FFFFFF?text=Signature+Dish:+Laksa',
                prosCons: {
                    pros: ['Authentic, rich laksa', 'Must-try roti canai', 'Great for sharing plates'],
                    cons: ['Limited seating available']
                },
                googleMapLink: 'https://maps.app.goo.gl/dummy9',
                phone: '+64 9 444 5555'
            },
            {
                id: 'r10',
                name: 'Taiwanese Noodle House',
                type: 'Taiwanese',
                distance: '2.1 km',
                price: '$',
                rating: 4.5,
                ratedBy: 1100,
                photo: 'https://placehold.co/600x400/EA580C/FFFFFF?text=Signature+Dish:+Beef+Noodle+Soup',
                prosCons: {
                    pros: ['Hearty, comforting noodle soups', 'Delicious, handmade dumplings', 'Quick and convenient'],
                    cons: ['Occasionally cash only']
                },
                googleMapLink: 'https://maps.app.goo.gl/dummy10',
                phone: '+64 9 666 7777'
            }
        ];

        const restaurantCardsContainer = document.getElementById('restaurant-cards-container');
        const searchSection = document.getElementById('search-section');
        const styleSearchInput = document.getElementById('style-search');
        const locationSearchInput = document.getElementById('location-search');
        const distanceFilter = document.getElementById('distance-filter');
        const priceRangeFilter = document.getElementById('price-range-filter');
        const ratingFilter = document.getElementById('rating-filter');
        const ratedByFilter = document.getElementById('rated-by-filter');
        const priceFilter = document.getElementById('price-filter');
        const searchButton = document.getElementById('search-button');
        const noResultsMessage = document.getElementById('no-results-message');
        const loadingIndicator = document.getElementById('loading-indicator');

        /**
         * Renders restaurant cards to the DOM.
         * @param {Array<Object>} restaurants - An array of restaurant objects.
         */
        function renderRestaurantCards(restaurants) {
            restaurantCardsContainer.innerHTML = ''; // Clear previous results
            if (restaurants.length === 0) {
                noResultsMessage.classList.remove('hidden');
                return;
            }
            noResultsMessage.classList.add('hidden');

            restaurants.forEach(restaurant => {
                const cardHtml = `
                    <div class="restaurant-card">
                        <img src="${restaurant.photo}" alt="Photo of ${restaurant.name}'s signature dish" class="rounded-t-xl">
                        <div class="restaurant-info">
                            <h3 class="restaurant-name">${restaurant.name}</h3>
                            <p class="restaurant-details">
                                ${restaurant.type} &bull; ${restaurant.distance} &bull; ${restaurant.price}
                            </p>
                            <div class="restaurant-rating">
                                <span class="star-icon">&#9733;</span>
                                <span class="font-semibold text-orange-700">${restaurant.rating}</span>
                                <span class="text-gray-500 ml-2">(${restaurant.ratedBy} ratings)</span>
                            </div>
                            <div class="pros-cons">
                                <p><strong>Pros:</strong> ${restaurant.prosCons.pros.join(', ')}</p>
                                <p><strong>Cons:</strong> ${restaurant.prosCons.cons.join(', ')}</p>
                            </div>
                            <div class="action-buttons">
                                <a href="${restaurant.googleMapLink}" target="_blank" class="map-link">
                                    View on Map
                                </a>
                                <a href="tel:${restaurant.phone}" class="phone-link">
                                    Call
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                restaurantCardsContainer.insertAdjacentHTML('beforeend', cardHtml);
            });
        }

        /**
         * Handles the search button click.
         * This function will now call the Netlify Function.
         */
        searchButton.addEventListener('click', async () => {
            loadingIndicator.classList.remove('hidden'); // Show loading indicator
            restaurantCardsContainer.innerHTML = ''; // Clear previous results
            noResultsMessage.classList.add('hidden'); // Hide no results message

            const styleQuery = styleSearchInput.value.toLowerCase().trim();
            const locationQuery = locationSearchInput.value.toLowerCase().trim();
            const distance = distanceFilter.value;
            const priceRange = priceRangeFilter.value;
            const minRating = ratingFilter.value;
            const minRatedBy = ratedByFilter.value;
            const avgPrice = priceFilter.value;

            // Construct query parameters for the Netlify Function
            const queryParams = new URLSearchParams({
                query: styleQuery || 'restaurants', // Default query if style is empty
                location: locationQuery,
                radius: distance,
                min_rating: minRating,
                min_rated_by: minRatedBy,
                max_price: avgPrice, // Assuming avgPrice maps to max_price for simplicity
                price_level: priceRange // Assuming priceRange maps to price_level
            }).toString();

            try {
                // *** THIS IS THE CRUCIAL CHANGE ***
                // Call your deployed Netlify Function
                const response = await fetch(`/.netlify/functions/searchRestaurants?${queryParams}`);

                if (!response.ok) {
                    // Handle HTTP errors from the Netlify Function itself
                    const errorData = await response.json();
                    throw new Error(`Netlify Function error: ${response.status} - ${errorData.error || 'Unknown error'}`);
                }

                const results = await response.json();
                renderRestaurantCards(results);

            } catch (error) {
                console.error('Error fetching restaurants:', error);
                // Display an error message to the user
                noResultsMessage.textContent = `Failed to load restaurants: ${error.message}. Please try again later.`;
                noResultsMessage.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden'); // Hide loading indicator
            }
        });

        /**
         * Minimises the search area on scroll down for better mobile experience.
         */
        window.addEventListener('scroll', () => {
            // Check if on a smaller screen (e.g., less than md breakpoint which is 768px)
            if (window.innerWidth < 768) {
                if (window.scrollY > 100) { // If scrolled down more than 100px
                    searchSection.classList.add('minimized');
                } else {
                    searchSection.classList.remove('minimized');
                }
            } else {
                // Ensure it's not minimized on larger screens
                searchSection.classList.remove('minimized');
            }
        });

        // Initial render of all dummy restaurants when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            renderRestaurantCards(dummyRestaurants);
        });
    </script>
</body>
</html>
